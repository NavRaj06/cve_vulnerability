package com.cve.project.controller;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import com.cve.project.model.CVE;
import com.cve.project.service.CVEService;

@RestController
@RequestMapping("/api")
public class CveController {

    @Autowired
    private CVEService cveService;

    @GetMapping("/fetch-and-store-cves/{resultsPerPage}/{startIndex}")
    public String fetchAndStoreCVEs(@PathVariable int resultsPerPage, @PathVariable int startIndex) {
        cveService.fetchCVEsFromNVD(resultsPerPage, startIndex);
        return "cve's added to db";
    }

    @GetMapping("/filterByCveId/{cveId}")
    public List<CVE> filterByCveId(@PathVariable String cveId) {
        System.out.println("cveId------------->" + cveId);
        List<CVE> response = cveService.filterByCveId(cveId);
        return response;
    }

    @GetMapping("/filterByScore/{baseScore}")
    public List<CVE> filterByScore(@PathVariable double baseScore) {
        System.out.println("baseScore------------->" + baseScore);
        List<CVE> response = cveService.filterByScore(baseScore);
        return response;
    }

    @GetMapping("/filterByLastModeified/{fromDate}/{toDate}")
    public List<CVE> filterByLastModeified(@PathVariable String fromDate, @PathVariable String toDate) {
        System.out.println("fromDate------------->" + fromDate);
        System.out.println("toDate------------->" + toDate);
        List<CVE> response = cveService.filterByLastModeified(fromDate, toDate);
        return response;
    }
}
